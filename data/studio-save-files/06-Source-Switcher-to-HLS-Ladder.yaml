__layout:
  - id: srt_input
    x: 304
    y: 32
  - id: abr_ladder
    x: 1072
    y: -192
  - id: preview
    x: 1072
    y: 240
  - id: smart_source_switch
    x: 672
    y: 32
  - id: ll-hls
    x: 1600
    y: 32
__globalConfig: {}
components:
  - type: input.srt-listener
    config:
      displayName: SRT Input
      port: 5001
      host: 0.0.0.0
      passphrase: ""
      socketOptions: {}
      sourceNames: permissive
      streamIds:
        - camera1
        - camera2
      notes: ""
      id: srt_input
    subscriptions: []
  - type: processor.fixedLadder
    config:
      displayName: ABR Ladder
      rungs:
        - name: h264_1280x720
          software:
            width: 1280
            height: 720
            codec:
              type: x264
              bitrateMode:
                value: 2500
                mode: abr
              keyFrameIntervalMax: 50
              keyFrameIntervalMin: 50
              sceneCut: 0
              preset: fast
              tune: zerolatency
              threads: 4
              bframes: 0
            frameRate:
              frames: 25
              seconds: 1
          quadra:
            width: 1280
            height: 720
            codec:
              type: quadra-h264
              intraPeriod: 50
              bitrate: 2500000
            frameRate:
              frames: 25
              seconds: 1
          nvidia:
            width: 1280
            height: 720
            codec:
              type: nv-h264
              idrPeriod: 50
              rateControl:
                mode: vbr
                averageBitrate: 2500000
            frameRate:
              frames: 25
              seconds: 1
        - name: h264_640x360
          software:
            width: 640
            height: 360
            codec:
              type: x264
              bitrateMode:
                value: 1000
                mode: abr
              keyFrameIntervalMax: 50
              keyFrameIntervalMin: 50
              sceneCut: 0
              preset: fast
              tune: zerolatency
              threads: 2
              bframes: 0
            frameRate:
              frames: 25
              seconds: 1
          quadra:
            width: 640
            height: 360
            codec:
              type: quadra-h264
              intraPeriod: 50
              bitrate: 1000000
            frameRate:
              frames: 25
              seconds: 1
          nvidia:
            width: 640
            height: 360
            codec:
              type: nv-h264
              idrPeriod: 50
              rateControl:
                mode: vbr
                averageBitrate: 1000000
            frameRate:
              frames: 25
              seconds: 1
        - name: h264_320x180
          software:
            width: 320
            height: 180
            codec:
              type: x264
              bitrateMode:
                value: 800
                mode: abr
              keyFrameIntervalMax: 50
              keyFrameIntervalMin: 50
              sceneCut: 0
              preset: fast
              tune: zerolatency
              threads: 1
              bframes: 0
            frameRate:
              frames: 25
              seconds: 1
          quadra:
            width: 320
            height: 180
            codec:
              type: quadra-h264
              intraPeriod: 50
              bitrate: 800000
            frameRate:
              frames: 25
              seconds: 1
          nvidia:
            width: 320
            height: 180
            codec:
              type: nv-h264
              idrPeriod: 50
              rateControl:
                mode: vbr
                averageBitrate: 800000
            frameRate:
              frames: 25
              seconds: 1
      id: abr_ladder
    subscriptions:
      - source: smart_source_switch
        streams:
          type: take-first-stream
          filter:
            - media: video
  - type: output.preview
    config:
      displayName: Preview
      previewMode: image
      showPreview: true
      jitterBuffer:
        bufferDelayMs: 500
      notes: ""
      makeProgram: true
      id: preview
    subscriptions:
      - source: smart_source_switch
        streams:
          type: take-first-stream
          filter:
            - media: video
            - media: audio
  - type: processor.smartSourceSwitch
    config:
      displayName: Smart Source Switch
      resolution:
        width: 1280
        height: 720
      frameRate:
        frames: 25
        seconds: 1
      sampleRate: 48000
      channelLayout: stereo
      sources:
        - camera1
        - camera2
      fallback:
        kind: testcard
      notes: ""
      id: smart_source_switch
    subscriptions:
      - source: srt_input
        streams:
          type: take-all-streams
          filter:
            - media: video
            - media: audio
  - type: output.autoCmaf
    config:
      displayName: LL-HLS
      name: default
      sessionId: true
      allowPreview: true
      segments:
        retentionPeriod: 60
        defaultSegmentCount: 0
        targetSegmentDuration: 4
        targetPartDuration: 1
        audioSegmentStrategy:
          type: default
        videoSegmentStrategy:
          type: default
        integralSegmentDuration: true
      destinations: []
      pushMode: hls_dash
      pdtEverySegment: true
      initialState: enabled
      multiplePrograms: false
      discontinuityHandling: discontinuity
      notes: ""
      makeProgram: true
      id: ll-hls
    subscriptions:
      - source: abr_ladder
        streams:
          type: take-all-streams
          filter:
            - media: video
      - source: smart_source_switch
        streams:
          type: take-specific-streams
          filter:
            - media: audio
              displayName: Smart Source Switch - audio
              sourceName: smart_source_switch
